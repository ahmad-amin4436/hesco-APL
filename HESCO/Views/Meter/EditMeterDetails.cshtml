@model HESCO.Models.MeterData

@{
    ViewData["Title"] = "Edit Meter";

    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-sm-10">
            <div class="card" style="background-color:blanchedalmond">
                <div class="card-body p-3">
                    <h1 style="text-align:center">Edit Meter</h1>

                    <form id="editMeterForm" asp-action="EditMeterDetails" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <input type="hidden" asp-for="MeterId" />
                        <div class="form-group">
                            <label asp-for="MSN" class="control-label"></label>
                            <input asp-for="MSN" class="form-control" />
                            <span asp-validation-for="MSN" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Description" class="control-label"></label>
                            <input asp-for="Description" class="form-control" readonly />
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="Comments" class="control-label"></label>
                            <input asp-for="Comments" class="form-control" />
                            <span asp-validation-for="Comments" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="MeterType" class="control-label"></label>
                            <input asp-for="MeterType" class="form-control" readonly />
                            <span asp-validation-for="MeterType" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <input type="submit" value="Update" class="btn btn-primary" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div>
        <a href="@Url.Action("ViewMeterList", "Meter")" class="btn btn-success">Back to List</a>
    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            $('#MSN').on('input', function () {
                var msnInput = $(this).val();
                if (msnInput.length >= 4) {
                    var prefix = msnInput.substring(0, 4);
                    $.ajax({
                        url: '@Url.Action("GetMeterType", "Meter")',
                        type: 'GET',
                        data: { prefix: prefix },
                        success: function (data) {
                            $('#MeterType').val(data);
                        }
                    });

                    // Generate and set the Description
                    var lastFourDigits = msnInput.substring(msnInput.length - 4);
                    $('#Description').val('Meter - ' + lastFourDigits);
                } else {
                    $('#MeterType').val(''); // Clear MeterType if less than 4 digits
                    $('#Description').val(''); // Clear Description if less than 4 digits
                }
            });
        });
    </script>
}