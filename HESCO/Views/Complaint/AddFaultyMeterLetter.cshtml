 @model HESCO.Models.Complaint.AddLetterModel

@{
    ViewData["Title"] = "Attach Faulty Meter Letter";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-sm-10">
            <div class="card" style="background-color:blanchedalmond">
                <div class="card-body p-3">
                    <h1 style="text-align:center">Attach Letter</h1>
                    <form asp-action="AddFaultyMeterLetter" method="post" enctype="multipart/form-data">
                        <div class="form-group">
                            <label asp-for="MSN" class="control-label"></label>
                            <select asp-for="MSN" class="form-control" id="msnDropdown" asp-items="ViewBag.SelectMSN" required>
                                <option value="">Select MSN</option>
                            </select>
                            <span asp-validation-for="MSN" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label for="FaultyImages">Attach Document</label>
                            <input type="file" name="FaultyImages" id="FaultyImages" multiple class="form-control"
                                   accept=".png,.jpeg,.jpg,.pdf,.doc,.docx,.xls,.xlsx,.xml" required />
                            <small class="form-text text-muted">You can upload up to 10 files.  Allowed formats: PNG, JPEG, JPG, PDF, DOC, DOCX, XLS, XLXS,XML.</small>
                        </div>
                        <div class="form-group">
                            <input type="submit" value="Attach Letter" class="btn btn-primary" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div>
    <a href="@Url.Action("ViewFaultyMeters", "Complaint")" class="btn btn-success">Back to List</a>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            // Initialize Select2 on the subdivision dropdown
            $('#msnDropdown').select2({
                placeholder: "Select MSN",
                allowClear: true
            });
        });
        $('#FaultyImages').on('change', function () {
            const maxFiles = 10;
            const allowedExtensions = ['.png', '.jpeg', '.jpg', '.pdf', '.doc', '.docx', '.xls', '.xlsx', '.xml'];
            const files = this.files;
            let isValid = true;
            let errorMsg = '';

            if (files.length > maxFiles) {
                errorMsg = 'You can only upload a maximum of 10 files.';
                isValid = false;
            }

            for (let i = 0; i < files.length; i++) {
                const fileExtension = '.' + files[i].name.split('.').pop().toLowerCase(); // Add '.' before the extension
                if ($.inArray(fileExtension, allowedExtensions) === -1) {
                    errorMsg = 'Invalid file type. Allowed formats: PNG, JPEG, JPG, PDF, DOC, DOCX, XLS, XLSX,XML.';
                    isValid = false;
                    break;
                }
            }

            if (!isValid) {
                alert(errorMsg);
                this.value = ''; // Clear the input if validation fails
            }
        });
    </script>
}
