@model HESCO.Models.Complaint.FaultyMeterViewModel

@{
    ViewData["Title"] = "Create FaultyMeters Complaint";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-sm-10">
            <div class="card" style="background-color:blanchedalmond">
                <div class="card-body p-3">
                    <h1 style="text-align:center">Create FaultyMeter Complaint</h1>

                    <form id="createFaultyMeterComplaintForm" asp-action="CreateFaultyMetersComplaint" enctype="multipart/form-data">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    @*     <!-- Project Dropdown -->
                        <div class="form-group">
                            <label asp-for="Project" class="control-label"></label>
                            <select asp-for="Project" class="form-control select2" id="projectDropdown" asp-items="ViewBag.SelectProject" required>
                                <option value="">Select a Project</option>
                            </select>
                            <span asp-validation-for="Project" class="text-danger"></span>
                        </div> *@
                        <div class="form-group">
                            <label asp-for="MSN" class="control-label"></label>
                                <input type="text" id="msn" name="MSN" class="form-control typeahead" placeholder="Select MSN" autocomplete="off" />
                            <span asp-validation-for="MSN" class="text-danger"></span>
                        </div>
                      @*   <div class="form-group">
                            <label for="SubDivCode">Sub Division Code</label>
                            <input type="text" id="SubDivCode" name="SubDivCode" class="form-control" readonly />
                        </div> *@
                        @* <div class="form-group">
                        <label asp-for="SubDivCode" class="control-label"></label>
                        <input type="text" id="SubDivName" class="form-control" readonly />
                        <input type="hidden" id="SubDivCode" name="SubDiv" />
                        <span asp-validation-for="SubDivCode" class="text-danger"></span>
                        </div> *@

                        <div class="form-group">
                            <label asp-for="OpenDescription" class="control-label"></label>
                            <input asp-for="OpenDescription" class="form-control" required />
                            <span asp-validation-for="OpenDescription" class="text-danger"></span>
                        </div>                        
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="DataReset" name="DataReset" value="1" @(Model.DataReset == 1 ? "checked" : "") />
                                <label class="form-check-label" for="DataReset">Data Reset</label>
                            </div>
                            <span asp-validation-for="DataReset" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <input type="submit" value="Create" class="btn btn-primary" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div>
        <a href="@Url.Action("ViewFaultyMeters", "Complaint")" class="btn btn-success">Back to List</a>
    </div>
</div>

@section Scripts
{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/corejs-typeahead/1.3.0/typeahead.bundle.min.js"></script>
    <script>
            $(document).ready(function () {
             var isMsnValid = false; // Default

        var MSNs = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('text'),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            remote: {
                url: '/Complaint/GetMSNs?query=%QUERY',
                wildcard: '%QUERY'
            }
        });

        $('#msn').typeahead({
            hint: true,
            highlight: true,
            minLength: 1
        }, {
            name: 'MSNs',
            display: 'text',
            source: MSNs
        }).on('typeahead:select', function (ev, suggestion) {
            $(this).typeahead('val', suggestion.text); // Display selected
            isMsnValid = true; // Mark as valid
            $('#isMsnValid').val('true'); // Update hidden field
        }).on('input', function () {
            // User is typing manually - reset validity
            isMsnValid = false;
            $('#isMsnValid').val('false');
        });

        // Form submission validation
        $("#createFaultyMeterComplaintForm").submit(function (e) {
            if (!isMsnValid) {
                alert("Please select a valid MSN from the suggestions.");
                e.preventDefault(); // Stop form from submitting
                return false;
            }
            return true;
        });
          });
        // $(document).ready(function () {
        //     // Initially hide the complaint form
        //     $("#CreateFaultyMeterForm").hide();

        //     // Event handler for project selection
        //     $("#projectDropdown").change(function () {
        //         var projectId = $(this).val(); // Get selected project ID
        //         $("#msn").val(""); // Clear msn input
        //         $("#msn").typeahead('destroy'); // Destroy previous Typeahead instance

        //         if (projectId) {
        //             $("#CreateFaultyMeterForm").show(); // Show form when a project is selected

        //             // Initialize Bloodhound (Typeahead's suggestion engine) with projectId filter
        //             var MSNs = new Bloodhound({
        //                 datumTokenizer: Bloodhound.tokenizers.obj.whitespace('text'),
        //                 queryTokenizer: Bloodhound.tokenizers.whitespace,
        //                 remote: {
        //                     url: '/Complaint/GetMSNsByProjectId?query=%QUERY&projectId=' + projectId, // Pass projectId
        //                     wildcard: '%QUERY'
        //                 }
        //             });

        //             // Initialize Typeahead on msn input
        //             $('#msn').typeahead({
        //                 hint: true,
        //                 highlight: true,
        //                 minLength: 1
        //             }, {
        //                 name: 'MSNs',
        //                 display: 'text',
        //                 source: MSNs
        //             }).on('typeahead:select', function (ev, suggestion) {
        //                 // When an item is selected from the Typeahead suggestions
        //                 var selectedValue = suggestion.value;

        //                 // Set the selected value into the input field
        //                 $(this).typeahead('val', suggestion.text);
        //             });

        //         } else {
        //             $("#CreateFaultyMeterForm").hide(); // Hide form if no project is selected
        //         }
        //     });
       
        //     // Ensure form validation before submission
        //     $("#createFaultyMeterComplaintForm").submit(function () {
        //         var msn = $("#msn").val();
        //         if (msn === "") {
        //             alert("No MSN is selected.");
        //             return false;
        //         }
        //         return true;
        //     });
        // });
    </script>
    <style>
        /* Add the custom CSS here */

        /* Typeahead dropdown container */
        .tt-menu {
            background-color: white; /* Set background color */
            border: 1px solid #ccc; /* Add border */
            border-radius: 4px; /* Slight rounding of corners */
            padding: 8px; /* Add some padding */
            width: 100%; /* Ensure it matches the input width */
            max-height: 200px; /* Limit the height */
            overflow-y: auto; /* Add scroll if necessary */
            z-index: 1000; /* Make sure it's on top of other elements */
        }

        /* Typeahead dropdown item */
        .tt-suggestion {
            padding: 8px; /* Add padding inside each item */
            cursor: pointer; /* Show pointer cursor on hover */
        }

            /* Highlight the selected item */
            .tt-suggestion.tt-cursor {
                background-color: #007bff; /* Background color on hover */
                color: white; /* Text color on hover */
            }

        /* Ensure the dropdown appears in the correct location */
        .twitter-typeahead {
            width: 100%; /* Ensure the dropdown width matches the input width */
        }

        /* Adjust the input to not overlap with the dropdown */
        .tt-hint {
            color: #999; /* Set hint color */
        }
    </style>
}