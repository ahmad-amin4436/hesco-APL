@{
    var currentUrl = Context.Request.Path.ToString().ToLower();
    var isReportsSection = currentUrl.Contains("report");
    var isUserSection = currentUrl.Contains("user");
    var isComplaintSection = currentUrl.Contains("complaint");
}
@inject MenuService MenuService
@using Microsoft.AspNetCore.Http
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@using Newtonsoft.Json

@{
    // 🔁 Replace this with how your app actually stores the user's role ID.
    // For example, from claims or session:
    //int roleId = int.Parse(User.FindFirst("role_id")?.Value ?? "0");
    int userId = HttpContextAccessor.HttpContext.Session.GetInt32("UserId") ?? 0;
    var menuItems = await MenuService.GetMenuItemsAsync(userId);



    var projectLinks = await MenuService.GetProjectLinksAsync();
    ViewBag.ProjectLinks = projectLinks;

    var projectName = await MenuService.GetProjectNameAsync();
    ViewBag.ProjectName = projectName;
}

<style>
    /* Remove default margin and arrow indicator */
    .navbar .dropdown-menu {
        margin-top: 0px !important;
        top: calc(100% + 0px) !important;
        transform: none !important;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

        /* Remove the triangle/arrow indicator */
        .navbar .dropdown-menu::before,
        .navbar .dropdown-menu::after {
            display: none !important;
        }
    /* Hide sidebar */
    .sidenav.collapsed {
        transform: translateX(-250px);
        transition: transform 0.3s ease;
    }

    /* Adjust main content */
    .main-content.expanded {
        margin-left: 0 !important;
        transition: margin 0.3s ease;
    }
</style>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="~/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="~/assets/img/icons/logo.png">
    <title>
        HESCO
    </title>
  
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="~/assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="~/assets/css/nucleo-svg.css" rel="stylesheet" />

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js" crossorigin="anonymous"></script>
    <!-- Font Awesome Icons -->
    @*     <script src="https://kit.fontawesome.com/9a5925da84.js" crossorigin="anonymous"></script> *@
    @* <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script> *@
    <link href="~/assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link id="pagestyle" href="~/assets/css/argon-dashboard.css?v=2.0.4" rel="stylesheet" />
    <link href="~/assets/css/custom.css" rel="stylesheet" />
</head>

<body class="g-sidenav-show   bg-gray-100">
    <div class="min-height-300 bg-primary position-absolute w-100"></div>
    <aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4" id="sidenav-main">
        <div class="sidenav-header">
            <i style="z-index:1" onclick="toggleSidenav()" class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
            <a class="navbar-brand m-0" href="@Url.Action("Index","Home")" target="_blank">
                <img src="~/assets/img/icons/logo.png" class="navbar-brand-img h-100" alt="main_logo">
                <span class="ms-1 font-weight-bold">HESCO</span>
            </a>
        </div>
        <hr class="horizontal dark mt-0">
        <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link @(currentUrl.Contains("home") ? "active" : "")" href="@Url.Action("Index","Home")">
                        <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                            <i class="ni ni-tv-2 text-primary text-sm opacity-10"></i>
                        </div>
                        <span class="nav-link-text ms-1">Dashboard</span>
                    </a>
                </li>
                @foreach (var item in menuItems.Where(m => m.ParentId == 0).OrderBy(m => m.DisplayOrder))
                {
                    <li class="nav-item">
                        <a class="nav-link @(isUserSection && item.Link.Contains("user") ? "active" : "")" href="#@item.Link" data-bs-toggle="collapse" aria-expanded="@(isUserSection && item.Link.Contains("user") ? "true" : "false")">
                            @if (!string.IsNullOrEmpty(item.FaIcon))
                            {
                                <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                                    <i class="fa @item.FaIcon"></i>
                                </div>
                            }
                            <span class="nav-link-text ms-1">@item.Title</span>
                        </a>
                        @if (menuItems.Any(m => m.ParentId == item.Id))
                        {
                            <div class="collapse @(isUserSection && item.Link.Contains("user") ? "show" : "")" id="@item.Link">
                                <ul class="nav nav-sm flex-column">
                                    @foreach (var subItem in menuItems.Where(m => m.ParentId == item.Id).OrderBy(m => m.DisplayOrder))
                                    {
                                        <li class="nav-item">
                                            <a class="nav-link @(currentUrl.Contains(subItem.Link.ToLower()) ? "active" : "")" href="@Url.Action(subItem.Link, subItem.Controller)">@subItem.Title</a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        }
                    </li>
                }
            </ul>
        </div>
    </aside>

    <main class="main-content position-relative border-radius-lg">
        <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" data-scroll="false">
            <div class="container-fluid py-1 px-3">
                <div class="nav-item d-flex align-items-center ps-3">               
                    <a href="javascript:;" class="nav-link text-white p-0" onclick="toggleSidebar()" id="toggleSidebarBtn">
                        <i class="fas fa-arrow-left" id="toggleIcon" style="font-size: 22px;"></i>
                    </a>
                </div>
                <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
                    <div class="d-flex align-items-center justify-content-between flex-grow-1">
                        <ul class="navbar-nav d-flex align-items-center">
                            <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
                                <a href="javascript:;" class="nav-link text-white p-0" id="iconNavbarSidenav">
                                    <div class="sidenav-toggler-inner">
                                        <i class="sidenav-toggler-line bg-white"></i>
                                        <i class="sidenav-toggler-line bg-white"></i>
                                        <i class="sidenav-toggler-line bg-white"></i>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <ul class="navbar-nav d-flex flex-row align-items-center mb-0 ms-auto gap-5">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <li class="nav-item">
                                    <span class="nav-link text-white font-weight-bold mb-0">
                                        @ViewBag.ProjectName
                                    </span>
                                </li>
                                <li class="nav-item">
                                    <span class="nav-link text-white font-weight-bold mb-0">
                                        Welcome @Context.Session.GetString("Username")
                                    </span>
                                </li>

                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle text-white font-weight-bold" href="#" id="discosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        DISCOs
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="discosDropdown">
                                        @foreach (var project in ViewBag.ProjectLinks as IEnumerable<ProjectLink>)
                                        {
                                            <li>
                                                <a class="dropdown-item" href="@project.project_url" target="_blank">@project.name</a>
                                            </li>
                                        }
                                    </ul>
                                </li>

                                <li class="nav-item">
                                    <form asp-controller="account" asp-action="logout" method="post" class="mb-0">
                                        <button type="submit" class="btn btn-link text-white font-weight-bold text-decoration-none mb-0 p-0" style="background-color: transparent;">
                                            Logout
                                        </button>
                                    </form>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item">
                                    <a href="@Url.Action("Loginuser", "Account")" class="nav-link text-white font-weight-bold">
                                        Login
                                    </a>
                                </li>
                            }
                        </ul>

                    </div>
                </div>
            </div>
        </nav>

        <div class="container-fluid py-4">
            @RenderBody()
            <footer class="footer pt-3">
                <div class="container-fluid">
                    <div class="row align-items-center justify-content-lg-between">
                        <div class="col-lg-6 mb-lg-0 mb-4">
                            <div class="copyright text-center text-sm text-muted text-lg-start">
                                @DateTime.Now.Year  HESCO
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                                <li class="nav-item">
                                    <a href="#" class="nav-link text-muted" target="_blank">About Us</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </main>

    <!--   Core JS Files   -->
    @*     <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script> *@

    <script src="~/assets/js/core/popper.min.js"></script>
    <script src="~/assets/js/core/bootstrap.min.js"></script>
    <script src="~/assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="~/assets/js/plugins/smooth-scrollbar.min.js"></script>
    <script src="~/assets/js/plugins/chartjs.min.js"></script>



    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.14/jspdf.plugin.autotable.min.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/css/bootstrap-datepicker.css" rel="stylesheet" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.8.0/js/bootstrap-datepicker.min.js"></script>

    <!-- FancyBox CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" />

    <!-- FancyBox JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>


    @* <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> *@
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="~/assets/js/core/popper.min.js"></script>
    <script src="~/assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="~/assets/js/plugins/smooth-scrollbar.min.js"></script>

    <script>
         var win = navigator.platform.indexOf('Win') > -1;
            if (win && document.querySelector('#sidenav-scrollbar')) {
                var options = {
                    damping: '0.5'
                }
                Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
            }

        // var win = navigator.platform.indexOf('Win') > -1;
        // if (win && document.querySelector('#sidenav-scrollbar')) {
        //     var options = {
        //         damping: '0.5'
        //     }
        //     Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        // }

        // $(document).ready(function () {
        //     toastr.options = {
        //         "closeButton": true,
        //         "debug": false,
        //         "newestOnTop": false,
        //         "progressBar": true,
        //         "positionClass": "toast-top-right",
        //         "preventDuplicates": true,
        //         "onclick": null,
        //         "showDuration": "300",
        //         "hideDuration": "1000",
        //         "timeOut": "5000",
        //         "extendedTimeOut": "1000",
        //         "showEasing": "swing",
        //         "hideEasing": "linear",
        //         "showMethod": "fadeIn",
        //         "hideMethod": "fadeOut"
        //     };

        //     var successMessage = '@TempData["SuccessMessage"]';
        //     if (successMessage) {
        //         toastr.success(successMessage, "Success");
        //     }

        //     var errorMessage = '@TempData["ErrorMessage"]';
        //     if (errorMessage) {
        //         toastr.error(errorMessage, "Error");
        //     }
        // });

        // function toggleSidenav() {
        //     let className = 'g-sidenav-pinned';
        //     const sidenav = document.getElementById('sidenav-main');
        //     let body = document.getElementsByTagName('body')[0];
        //     if (body.classList.contains(className)) {
        //         body.classList.remove(className);
        //         setTimeout(function () {
        //             sidenav.classList.remove('bg-white');
        //         }, 100);
        //         sidenav.classList.remove('bg-transparent');
        //     } else {
        //         body.classList.add(className);
        //         sidenav.classList.add('bg-white');
        //         sidenav.classList.remove('bg-transparent');
        //         document.getElementById('iconSidenav').classList.remove('d-none');
        //     }
        // }

    </script>
    @*   <script src="~/assets/js/datatables.min.js"></script> *@
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script>
        function toggleSidebar() {
    const sidebar = document.getElementById('sidenav-main');
    const mainContent = document.querySelector('.main-content');
    const icon = document.getElementById('toggleIcon');

    sidebar.classList.toggle('collapsed');
    mainContent.classList.toggle('expanded');

    if (sidebar.classList.contains('collapsed')) {
        // Menu hidden → arrow should be →
        icon.classList.remove('fa-arrow-left');
        icon.classList.add('fa-arrow-right');
    } else {
        // Menu open → arrow should be ←
        icon.classList.remove('fa-arrow-right');
        icon.classList.add('fa-arrow-left');
    }
}

// Set initial state: hidden with arrow →
document.addEventListener("DOMContentLoaded", function () {
    const sidebar = document.getElementById('sidenav-main');
    const mainContent = document.querySelector('.main-content');
    const icon = document.getElementById('toggleIcon');

    sidebar.classList.add('collapsed');
    mainContent.classList.add('expanded');

    // Force initial arrow to →
    icon.classList.remove('fa-arrow-left');
    icon.classList.add('fa-arrow-right');
});
        // $(function () {

        //     const iconSidenav = document.getElementById('iconSidenav');

        //     if (iconNavbarSidenav) {
        //         iconNavbarSidenav.addEventListener("click", toggleSidenav);
        //     }

        //     if (iconSidenav) {
        //         iconSidenav.addEventListener("click", toggleSidenav);
        //     }
        // });
        // function toggleSidenav() {
        //     let className = 'g-sidenav-pinned';
        //     const sidenav = document.getElementById('sidenav-main');
        //     let body = document.getElementsByTagName('body')[0];
        //     if (body.classList.contains(className)) {
        //         body.classList.remove(className);
        //         setTimeout(function () {
        //             sidenav.classList.remove('bg-white');
        //         }, 100);
        //         sidenav.classList.remove('bg-transparent');

        //     } else {
        //         body.classList.add(className);
        //         sidenav.classList.add('bg-white');
        //         sidenav.classList.remove('bg-transparent');
        //         iconSidenav.classList.remove('d-none');
        //     }
        // }
        //  function toggleSidebar() {
        //     const sidebar = document.getElementById('sidenav-main');
        //     const mainContent = document.querySelector('.main-content');
        //     const icon = document.getElementById('toggleIcon');

        //     sidebar.classList.toggle('collapsed');
        //     mainContent.classList.toggle('expanded');

        //     if (sidebar.classList.contains('collapsed')) {
        //         icon.classList.remove('fa-arrow-left');
        //         icon.classList.add('fa-arrow-right');
        //     } else {
        //         icon.classList.remove('fa-arrow-right');
        //         icon.classList.add('fa-arrow-left');
        //     }
        // }
    </script>
    @RenderSection("scripts", false)

</body>

</html>